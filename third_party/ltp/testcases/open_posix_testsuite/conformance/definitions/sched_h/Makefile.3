all: $(MAKE_TARGETS)
	@if [ -d speculative ]; then $(MAKE) -C speculative all; fi

clean:
	rm -f $(MAKE_TARGETS) logfile* run.sh *.core
	@if [ -d speculative ]; then $(MAKE) -C speculative clean; fi

install: $(INSTALL_DIR) run.sh
	set -e; for file in $(INSTALL_TARGETS) run.sh; do	\
		if [ -f "$$file" ] ; then			\
			install -m 00755 $$file		\
				$(INSTALL_DIR)/$$file;	\
		fi;						\
	done
	@if [ -d speculative ]; then $(MAKE) -C speculative install; fi

test: run.sh
	@./run.sh

$(INSTALL_DIR):
	mkdir -p $@

run.sh:
	@echo '#!/bin/sh' > $@
	@echo "$(top_srcdir)/bin/run-tests.sh $(subdir) $(INSTALL_TARGETS)" >> $@
	@chmod +x run.sh

sched_h_3-1-buildonly.test: $(srcdir)/3-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/3-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/3-1-buildonly compile PASSED"; \
		 echo "$(subdir)/3-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/3-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/3-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_8-4-buildonly.test: $(srcdir)/8-4-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/8-4-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/8-4-buildonly compile PASSED"; \
		 echo "$(subdir)/8-4-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/8-4-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/8-4-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_1-1-buildonly.test: $(srcdir)/1-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/1-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/1-1-buildonly compile PASSED"; \
		 echo "$(subdir)/1-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/1-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/1-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_18-1-buildonly.test: $(srcdir)/18-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/18-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/18-1-buildonly compile PASSED"; \
		 echo "$(subdir)/18-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/18-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/18-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_14-1-buildonly.test: $(srcdir)/14-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/14-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/14-1-buildonly compile PASSED"; \
		 echo "$(subdir)/14-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/14-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/14-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_4-1-buildonly.test: $(srcdir)/4-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/4-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/4-1-buildonly compile PASSED"; \
		 echo "$(subdir)/4-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/4-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/4-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_8-1-buildonly.test: $(srcdir)/8-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/8-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/8-1-buildonly compile PASSED"; \
		 echo "$(subdir)/8-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/8-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/8-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_12-1-buildonly.test: $(srcdir)/12-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/12-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/12-1-buildonly compile PASSED"; \
		 echo "$(subdir)/12-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/12-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/12-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_15-1-buildonly.test: $(srcdir)/15-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/15-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/15-1-buildonly compile PASSED"; \
		 echo "$(subdir)/15-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/15-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/15-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_19-1-buildonly.test: $(srcdir)/19-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/19-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/19-1-buildonly compile PASSED"; \
		 echo "$(subdir)/19-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/19-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/19-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_8-2-buildonly.test: $(srcdir)/8-2-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/8-2-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/8-2-buildonly compile PASSED"; \
		 echo "$(subdir)/8-2-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/8-2-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/8-2-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_17-1-buildonly.test: $(srcdir)/17-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/17-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/17-1-buildonly compile PASSED"; \
		 echo "$(subdir)/17-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/17-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/17-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_8-3-buildonly.test: $(srcdir)/8-3-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/8-3-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/8-3-buildonly compile PASSED"; \
		 echo "$(subdir)/8-3-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/8-3-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/8-3-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_11-1-buildonly.test: $(srcdir)/11-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/11-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/11-1-buildonly compile PASSED"; \
		 echo "$(subdir)/11-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/11-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/11-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_16-1-buildonly.test: $(srcdir)/16-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/16-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/16-1-buildonly compile PASSED"; \
		 echo "$(subdir)/16-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/16-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/16-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_13-1-buildonly.test: $(srcdir)/13-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/13-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/13-1-buildonly compile PASSED"; \
		 echo "$(subdir)/13-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/13-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/13-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_2-1-buildonly.test: $(srcdir)/2-1-buildonly.c
	@if $(CC) -c $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/2-1-buildonly.c > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/2-1-buildonly compile PASSED"; \
		 echo "$(subdir)/2-1-buildonly compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/2-1-buildonly compile FAILED; SKIPPING"; \
		(echo "$(subdir)/2-1-buildonly compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

sched_h_10-1.run-test: $(srcdir)/10-1.c
	@if $(CC)  $(CFLAGS) $(LDFLAGS) -o $@ $(srcdir)/10-1.c $(LDLIBS) > logfile.$$$$ 2>&1; then \
		 cat logfile.$$$$; \
		 echo "$(subdir)/10-1 compile PASSED"; \
		 echo "$(subdir)/10-1 compile PASSED" >> $(LOGFILE); \
	else \
		 cat logfile.$$$$; \
		 echo "$(subdir)/10-1 compile FAILED; SKIPPING"; \
		(echo "$(subdir)/10-1 compile FAILED; SKIPPING"; cat logfile.$$$$) >> $(LOGFILE); \
	fi; \
	rm -f logfile.$$$$

